<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¥½ã¿ã®ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã‚ã‹ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="å¥½ã¿ã®ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã‚ã‹ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­" />
  <meta name="twitter:description" content="3ã¤é¸ã¶ã ã‘ï¼ˆé‡è¤‡OKï¼‰ã€‚ã‚¿ã‚¤ãƒ—/ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ/ãƒãƒ©ãƒ³ã‚¹/é©æ€§ã‚¸ãƒ£ãƒ³ãƒ«/ãŠã™ã™ã‚/ç·è©•ã‚’è¡¨ç¤ºï¼†XæŠ•ç¨¿ã€‚" />

  <style>
    :root{
      --bg:#0b0f14; --card:#111826; --text:#e6eefc; --muted:#a9b6cc;
      --line:rgba(255,255,255,0.12);
      --accent:rgba(125,211,252,0.65);
      --accent2:rgba(125,211,252,0.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, #17223a, var(--bg));
      color:var(--text);
    }
    header{max-width:1040px;margin:0 auto;padding:22px 16px 10px}
    h1{margin:0 0 6px;font-size:22px;letter-spacing:.2px}
    p{margin:0;color:var(--muted);line-height:1.55}
    .wrap{max-width:1040px;margin:0 auto;padding:12px 16px 28px;display:grid;gap:14px}
    .grid{display:grid;gap:12px}
    @media(min-width:980px){.grid{grid-template-columns:1.05fr .95fr}}
    .card{
      background:rgba(17,24,38,.92);
      border:1px solid var(--accent2);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 34px rgba(0,0,0,.28);
    }
    .badge{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(125,211,252,.25);
      background:rgba(125,211,252,.10);
      font-weight:900;
      margin:0 8px 8px 0;
    }
    label{display:block;font-weight:950;margin:10px 0 6px}
    .subLabel{display:block;font-weight:750;color:var(--muted);font-size:12px;margin-top:2px}
    input[type="text"], select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--text);
      font-size:16px;
      outline:none;
    }
    .row{display:grid;gap:10px}
    @media(min-width:520px){.row.two{grid-template-columns:1fr 1fr}}
    button{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--accent);
      background:linear-gradient(180deg, rgba(125,211,252,.22), rgba(125,211,252,.08));
      color:var(--text);
      font-size:16px;
      font-weight:950;
      cursor:pointer;
      margin-top:10px;
    }
    button:hover{border-color:rgba(125,211,252,.95)}
    .ghost{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
    }
    .hr{height:1px;background:var(--line);margin:12px 0}
    .title{font-size:22px;font-weight:1000;margin:2px 0 6px}
    .desc{color:var(--muted);line-height:1.65}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Noto Sans Mono",monospace}
    .mini{font-size:12px;color:var(--muted)}
    .stars{letter-spacing:.5px}
    .klist{display:grid;gap:6px}
    .kitem{display:flex;justify-content:space-between;gap:10px}
    .kitem span:first-child{color:var(--muted)}
    .foot{color:var(--muted);font-size:13px;line-height:1.55}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      padding:6px 10px;border-radius:999px;
      color:var(--muted);font-size:13px;
    }
    textarea{
      width:100%;
      min-height:120px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      resize:vertical;
      font-size:13px;
      line-height:1.5;
      outline:none;
    }
    .btnRow{display:grid;gap:10px}
    @media(min-width:520px){.btnRow{grid-template-columns:1fr 1fr}}
  </style>
</head>

<body>
<header>
  <h1>å¥½ã¿ã®ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã‚ã‹ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>
  <p>Operate with / Own / Also Like ã‚’é¸ã¶ã ã‘ï¼ˆé‡è¤‡OKï¼‰ã€‚çµæœã¯æ—¥æœ¬èªãƒ»è‹±èªã§è¡¨ç¤ºï¼†XæŠ•ç¨¿ã§ãã¾ã™ã€‚</p>
</header>

<div class="wrap">
  <div class="grid">
    <div class="card">
      <span class="badge">Input / å…¥åŠ›</span>

      <div class="row two">
        <div>
          <label for="name">Name / åå‰ <span class="subLabel">è¡¨ç¤ºåï¼ˆä»»æ„ï¼‰</span></label>
          <input id="name" type="text" placeholder="Your name / åå‰" />
        </div>
        <div>
          <label for="lang">Result Language / çµæœã®è¨€èª</label>
          <select id="lang">
            <option value="ja">Japanese / æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
            <option value="en">English / è‹±èª ğŸ‡ºğŸ‡¸</option>
          </select>
        </div>
      </div>

      <div class="hr"></div>

      <span class="badge">Speaker Selection / ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼é¸æŠ</span>

      <label for="op">1ï¸âƒ£ Operate with <span class="subLabel">ä½¿ã„ãŸã„ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼</span></label>
      <select id="op"></select>

      <label for="own">2ï¸âƒ£ Own / Would Buy <span class="subLabel">è³¼å…¥ãƒ»æ‰€æŒã—ãŸã„ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼</span></label>
      <select id="own"></select>

      <label for="second">3ï¸âƒ£ Also Like <span class="subLabel">ã“ã‚Œã‚‚å¥½ããªã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼</span></label>
      <select id="second"></select>

      <button id="calc">Diagnose / è¨ºæ–­ã™ã‚‹ ğŸ”</button>

      <div class="btnRow">
        <button id="tweet" class="ghost" style="display:none;">Post to X / Xã«æŠ•ç¨¿ ğŸ¦</button>
        <button id="copy" class="ghost" style="display:none;">Copy X Text / æŠ•ç¨¿æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="hr"></div>
      <div class="foot">
        <span class="pill">Duplicates OK / é‡è¤‡OK</span>
        <span class="pill">Link â†’ Diagnosis URL / è¨ºæ–­URLã¸</span>
      </div>

      <div class="hr"></div>
      <span class="badge">X Preview / XæŠ•ç¨¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè‡ªå‹•280å­—ï¼‰</span>
      <textarea id="tweetPreview" readonly placeholder="è¨ºæ–­ã™ã‚‹ã¨ã“ã“ã«XæŠ•ç¨¿æ–‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ / Run diagnosis to generate X text"></textarea>
      <div class="mini" id="countInfo"></div>
    </div>

    <div class="card" id="out">
      <span class="badge">Result / çµæœ</span>
      <div class="desc">å·¦ã§å…¥åŠ›ã—ã¦ã€ŒDiagnose / è¨ºæ–­ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  // --- Speaker list (ABC) ---
  const SPEAKERS = [
    "Adamson",
    "Clair",
    "CODA",
    "d&b",
    "EAW",
    "JBL",
    "L-Acoustics",
    "Martin Audio",
    "Meyer Sound",
    "NEXO"
  ];

  function fillSelect(selId){
    const sel = $(selId);
    sel.innerHTML = `<option value="">Selectâ€¦</option>` + SPEAKERS.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join("");
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  fillSelect("op"); fillSelect("own"); fillSelect("second");

  // --- Weighting (operate > own > also like) ---
  const WEIGHT = { op: 1.25, own: 1.00, second: 0.85 };

  // --- Axes for balance (fixed 5) ---
  const AXES5 = ["impact", "detail", "speed", "throw", "system"];

  const AXIS_LABEL = {
    ja: {
      impact:"éŸ³åœ§ãƒ»ãƒ˜ãƒƒãƒ‰ãƒ«ãƒ¼ãƒ ",
      detail:"ç¹Šç´°ã•ãƒ»è§£åƒåº¦",
      speed:"ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹",
      throw:"é é”æ€§ãƒ»å‡ä¸€æ€§",
      system:"æ©Ÿèƒ½ãƒ»å†ç¾æ€§",
    },
    en: {
      impact:"Impact / Headroom",
      detail:"Detail / Resolution",
      speed:"Speed / Transient",
      throw:"Throw / Coverage",
      system:"System / Predictability",
    }
  };

  // --- Types (same as before) ---
  const TYPES = [
    { key:"impact_attack",
      name:{ ja:"éŸ³åœ§ä¸»å°ãƒ»ã‚¢ã‚¿ãƒƒã‚¯é‡è¦–ã‚¿ã‚¤ãƒ—", en:"Impact / Attack Engineer" },
      desc:{ ja:"éŸ³ã®ç«‹ã¡ä¸ŠãŒã‚Šã¨å½“ãŸã‚Šã‚’æœ€å„ªå…ˆã€‚å¤šå°‘ã®è’ã•ã‚ˆã‚Šã€Œå‡ºã¦ã„ã‚‹ã‹ã©ã†ã‹ã€ã§åˆ¤æ–­ã™ã‚‹ã€‚", en:"Prioritizes transient impact and the initial hit over smoothness. Judges by whether it truly â€˜hitsâ€™." },
      approach:{ ja:["ã‚¢ã‚¿ãƒƒã‚¯ã‚’æ®ºã•ãªã„","å‹¢ã„ã‚’ä½œã£ã¦ã‹ã‚‰æ•´ãˆã‚‹","ç¬¬ä¸€å°è±¡ã‚’æœ€å„ªå…ˆ"], en:["Preserve attack and transients","Build impact first, balance later","Judge by first impression"] },
      genres:{ ja:["ãƒ­ãƒƒã‚¯ / ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯","ãƒãƒ³ãƒ‰ç³»ãƒ©ã‚¤ãƒ–","ä½“æ„Ÿé‡è¦–ã®ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ—ï¼ˆç”Ÿï¼‰"], en:["Rock / Hard Rock","Band-oriented live shows","Impact-driven Hip-Hop (live)"] },
      final:{ ja:"ã‚ãªãŸã¯ã€éŸ³ã§ç©ºæ°—ã‚’å‹•ã‹ã›ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚ç«‹ã¡ä¸ŠãŒã‚Šã¨å½“ãŸã‚Šã‚’ä¿¡ã˜ã¦åˆ¤æ–­ã§ãã‚‹ã®ã¯ã€ãƒ©ã‚¤ãƒ–ã‚’â€œå§‹ã‚ã‚‰ã‚Œã‚‹äººâ€ã®ç‰¹æ¨©ã§ã™ã€‚", en:"You are an engineer who can move the room with sound. Trusting impact and attack is the mark of someone who knows how to start a show." }
    },
    { key:"lowend_impact",
      name:{ ja:"ä½ä¸­åŸŸä½“æ„Ÿãƒ»ãƒ‘ãƒ³ãƒã‚¿ã‚¤ãƒ—", en:"Low-End Impact Engineer" },
      desc:{ ja:"è´ã“ãˆæ–¹ã‚ˆã‚Šä½“æ„Ÿã‚’é‡è¦–ã€‚ãƒ­ãƒ¼ã€œãƒ­ãƒ¼ãƒŸãƒƒãƒ‰ã®å¯†åº¦ã¨æŠ¼ã—å‡ºã—ã§èª¬å¾—åŠ›ã‚’ä½œã‚‹ã€‚", en:"Prioritizes physical impact and weight. Builds authority through low-end density and push." },
      approach:{ ja:["ãƒ­ãƒ¼ã€œãƒ­ãƒ¼ãƒŸãƒƒãƒ‰ã®å¯†åº¦ã‚’ä½œã‚‹","ã‚µãƒ–ã®ç¿»è¨³ã‚’æœ€å„ªå…ˆ","ä½“æ„Ÿã‚’å´©ã™å‡¦ç†ã¯é¿ã‘ã‚‹"], en:["Build low-end density","Prioritize sub translation","Avoid processing that kills weight"] },
      genres:{ ja:["ãƒ’ãƒƒãƒ—ãƒ›ãƒƒãƒ— / R&B","ãƒ­ãƒƒã‚¯ï¼ˆé‡å¿ƒä½ã‚ï¼‰","ãƒ•ã‚§ã‚¹ï¼ˆä½“æ„Ÿå‹è² ï¼‰"], en:["Hip-Hop / R&B","Rock (low-centered)","Festivals (physical impact)"] },
      final:{ ja:"ã‚ãªãŸã¯ã€éŸ³ã‚’ã€Œè´ã‹ã›ã‚‹ã€ã‚ˆã‚Šã€Œæ„Ÿã˜ã•ã›ã‚‹ã€ã“ã¨ãŒã§ãã¾ã™ã€‚ä½“æ„Ÿã‚’ä½œã‚Œã‚‹åˆ¤æ–­åŠ›ã¯ã€ãƒ©ã‚¤ãƒ–ã®èª¬å¾—åŠ›ãã®ã‚‚ã®ã§ã™ã€‚", en:"You donâ€™t just make sound heard â€” you make it felt. Your sense of physical impact gives live sound its real power." }
    },
    { key:"groove_transient",
      name:{ ja:"ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ»ã‚°ãƒ«ãƒ¼ãƒ´å„ªå…ˆã‚¿ã‚¤ãƒ—", en:"Groove & Transient Engineer" },
      desc:{ ja:"ãƒãƒªã¨ã‚­ãƒ¬ã‚’æœ€å„ªå…ˆã€‚ç«‹ã¡ä¸ŠãŒã‚Šã¨ãƒªã‚ºãƒ ã®æ˜ç¢ºã•ã§éŸ³æ¥½ã‚’å‰ã«é€²ã‚ã‚‹ã€‚", en:"Prioritizes groove and transient definition. Keeps music moving through speed and rhythmic clarity." },
      approach:{ ja:["ç«‹ã¡ä¸ŠãŒã‚Šã¨ã‚­ãƒ¬ã‚’ä¿ã¤","ã‚¿ã‚¤ãƒˆã•ã§ã‚°ãƒ«ãƒ¼ãƒ´ã‚’ä½œã‚‹","æ¿ã‚Šã¯ã¾ãšæ•´ç†"], en:["Keep transients sharp","Build groove through tightness","Clear mud first"] },
      genres:{ ja:["ãƒ€ãƒ³ã‚¹ / EDM","ãƒ¡ã‚¿ãƒ«ï¼ˆé€Ÿã„æ›²ï¼‰","ã‚¯ãƒ©ãƒ– / ãƒ©ã‚¤ãƒ–ãƒã‚¦ã‚¹"], en:["Dance / EDM","Fast metal","Clubs / small venues"] },
      final:{ ja:"ã‚ãªãŸã¯ã€ãƒãƒªãŒç”Ÿãã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æœ€åˆã«è¦‹æŠœã‘ã‚‹äººã§ã™ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã‚’ä¿ã¦ã‚‹åˆ¤æ–­ã¯ã€éŸ³æ¥½ã‚’å‰ã«é€²ã‚ã¾ã™ã€‚", en:"You instinctively know when the groove is alive. Your focus on speed keeps the music moving forward." }
    },
    { key:"detail_focus",
      name:{ ja:"ç¹Šç´°ãƒ»éŸ³åƒæ•´ç†ã‚¿ã‚¤ãƒ—", en:"Detail-Focused Engineer" },
      desc:{ ja:"æƒ…å ±é‡ã¨åˆ†é›¢ã‚’é‡è¦–ã€‚ä½•ãŒé³´ã£ã¦ã„ã‚‹ã‹ã‚’å®ˆã‚Šã€éŸ³åƒã‚’æ•´ãˆã¦ä¼ãˆã‚‹ã€‚", en:"Prioritizes detail and separation. Organizes the soundstage so every element is understood." },
      approach:{ ja:["æƒ…å ±é‡ã‚’æ®‹ã—ã¦æ•´ç†ã™ã‚‹","è¼ªéƒ­ã‚’å´©ã•ãªã„EQ/ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹","å¼•ãç®—ã§æ˜ç­åº¦ã‚’ä¸Šã’ã‚‹"], en:["Organize without losing detail","Use EQ/dynamics that preserve edges","Subtract to increase clarity"] },
      genres:{ ja:["ãƒãƒƒãƒ—ã‚¹","ã‚¸ãƒ£ã‚º / ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯","æ˜ åƒåéŒ²"], en:["Pop","Jazz / Acoustic","Broadcast / recording"] },
      final:{ ja:"ã‚ãªãŸã¯ã€éŸ³ã®æƒ…å ±é‡ã‚’æ­£ç¢ºã«æ‰±ãˆã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚ã€Œä½•ãŒé³´ã£ã¦ã„ã‚‹ã‹ã€ã‚’å®ˆã‚Œã‚‹åˆ¤æ–­ã¯ã€éŸ³æ¥½ã¸ã®èª å®Ÿã•ã§ã™ã€‚", en:"You handle sonic detail with precision and care. Preserving clarity is your way of respecting the music." }
    },
    { key:"phase_clarity",
      name:{ ja:"ç¶ºéº—ãƒ»æ³¢é¢æ•´åˆã‚¿ã‚¤ãƒ—", en:"Phase & Clarity Engineer" },
      desc:{ ja:"æ•´åˆã¨ç¾ã—ã•ã‚’é‡è¦–ã€‚ãƒ¬ãƒ³ã‚¸ã¨å®šä½ã®â€œå´©ã‚Œâ€ã‚’å«Œã„ã€å®Œæˆåº¦ã§å‹è² ã™ã‚‹ã€‚", en:"Values alignment and cleanliness. Avoids phase smear and builds mixes on coherence and polish." },
      approach:{ ja:["æ•´åˆã¨ãƒ¬ãƒ³ã‚¸ã®ç¾ã—ã•ã‚’å®ˆã‚‹","å®šä½ãŒå´©ã‚Œã‚‹å‡¦ç†ã¯é¿ã‘ã‚‹","å¿…è¦æœ€å°é™ã®å‡¦ç†ã§å®Œæˆåº¦"], en:["Protect coherence and bandwidth","Avoid phase-smearing moves","Minimal processing, high polish"] },
      genres:{ ja:["ãƒãƒƒãƒ—ã‚¹ï¼ˆä¸Šå“ï¼‰","åŠ‡å ´ / ãƒ›ãƒ¼ãƒ«","ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©å¯„ã‚Š"], en:["Polished pop","Theaters / halls","Orchestral-leaning shows"] },
      final:{ ja:"ã‚ãªãŸã¯ã€éŸ³ã®ç¾ã—ã•ã‚’å´©ã•ãªã„ã“ã¨ã«ä¾¡å€¤ã‚’è¦‹å‡ºã—ã¾ã™ã€‚æ•´åˆã®å–ã‚ŒãŸéŸ³ã‚’ä½œã‚Œã‚‹ã®ã¯ã€é«˜ã„å®Œæˆåº¦ã‚’çŸ¥ã£ã¦ã„ã‚‹è¨¼æ‹ ã§ã™ã€‚", en:"You value coherence and sonic beauty. Your pursuit of alignment reflects a deep sense of quality." }
    },
    { key:"vocal_centric",
      name:{ ja:"ãƒœãƒ¼ã‚«ãƒ«ä¸­å¿ƒãƒ»è‡ªç„¶æ´¾ã‚¿ã‚¤ãƒ—", en:"Vocal-Centric Engineer" },
      desc:{ ja:"å£°ã‚’ä¸­å¿ƒã«éŸ³æ¥½ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã€‚æ­Œãƒ»è¨€è‘‰ã®è‡ªç„¶ã•ã‚’æœ€å„ªå…ˆã—ã¦æˆç«‹ã•ã›ã‚‹ã€‚", en:"Builds the mix around the voice. Prioritizes intelligibility and natural vocal presence." },
      approach:{ ja:["æ­ŒãŒè‡ªç„¶ã«ç«‹ã¤ã®ãŒæœ€å„ªå…ˆ","ä¸­åŸŸã®è³ªæ„Ÿã‚’å®ˆã‚‹","éåº¦ãªå‘³ä»˜ã‘ã‚’ã—ãªã„"], en:["Vocals first, naturally","Protect midrange texture","Avoid over-coloring"] },
      genres:{ ja:["æ­Œãƒ¢ãƒ / ã‚·ãƒ³ã‚¬ãƒ¼","ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ« / æ¼”åŠ‡","ã‚¸ãƒ£ã‚ºï¼ˆæ­Œï¼‰"], en:["Singer-driven shows","Musicals / theater","Vocal jazz"] },
      final:{ ja:"ã‚ãªãŸã¯ã€äººã®å£°ã‚’ä¸­å¿ƒã«éŸ³æ¥½ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚æ­Œã‚’è‡ªç„¶ã«ç«‹ãŸã›ã‚‹åˆ¤æ–­åŠ›ã¯ã€ç¾å ´ã§æœ€ã‚‚ä¿¡é ¼ã•ã‚Œã¾ã™ã€‚", en:"You build mixes around the human voice. Your ability to let vocals breathe earns lasting trust on site." }
    },
    { key:"coverage_control",
      name:{ ja:"å‡ä¸€ã‚«ãƒãƒ¼ãƒ»å…¨ä½“ä¸»ç¾©ã‚¿ã‚¤ãƒ—", en:"Coverage-Control Engineer" },
      desc:{ ja:"ä¼šå ´å…¨ä½“ã®å‡ä¸€æ€§ã‚’æœ€å„ªå…ˆã€‚ã©ã®å¸­ã§ã‚‚æˆç«‹ã™ã‚‹éŸ³ã‚’ä½œã‚‹â€œå…¨ä½“è¦–ç‚¹â€ã®äººã€‚", en:"Prioritizes consistency across the venue. Thinks system-wide to make every seat work." },
      approach:{ ja:["å…¨å¸­ã®æˆç«‹ã‚’æœ€å„ªå…ˆ","ç ´ç¶»ãƒã‚¤ãƒ³ãƒˆã‚’ä½œã‚‰ãªã„","å…¨ä½“ãƒãƒ©ãƒ³ã‚¹ã§æŠ¼ã•ãˆã‚‹"], en:["Make every seat work","Avoid failure zones","Hold the mix in system balance"] },
      genres:{ ja:["ä¼æ¥­ / å¤šç›®çš„","ãƒãƒƒãƒ—ã‚¹ï¼ˆå‡ä¸€é‡è¦–ï¼‰","ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«"], en:["Corporate / multipurpose","Pop (consistency)","Musicals"] },
      final:{ ja:"ã‚ãªãŸã¯ã€ä¼šå ´å…¨ä½“ã‚’ä¸€ã¤ã®éŸ³ã¨ã—ã¦æ‰ãˆã‚‰ã‚Œã‚‹äººã§ã™ã€‚èª°ä¸€äººç½®ã„ã¦ã„ã‹ãªã„åˆ¤æ–­ãŒã€ç¾å ´ã‚’å®‰å®šã•ã›ã¾ã™ã€‚", en:"You listen to the entire space as one system. Your commitment to consistency keeps shows solid and reliable." }
    },
    { key:"long_throw",
      name:{ ja:"é é”ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«è¨­è¨ˆã‚¿ã‚¤ãƒ—", en:"Long-Throw System Engineer" },
      desc:{ ja:"è·é›¢ã¨è¦æ¨¡ã‚’å‰æã«è¨­è¨ˆã™ã‚‹ã€‚é é”ã¨æ˜ç­åº¦ã®ä¸¡ç«‹ã§å¤§è¦æ¨¡ã‚’æˆç«‹ã•ã›ã‚‹ã€‚", en:"Designs for distance and scale. Balances throw and intelligibility to make large venues work." },
      approach:{ ja:["è·é›¢ã‚’å‰æã«æ˜ç­åº¦ã‚’ä½œã‚‹","é é”ã®ç ´ç¶»ã‚’å…ˆã«æ½°ã™","è¦æ¨¡ã§å´©ã‚Œãªã„åˆ¤æ–­"], en:["Build intelligibility for distance","Eliminate throw failure first","Scale-proof decisions"] },
      genres:{ ja:["ãƒ•ã‚§ã‚¹ï¼ˆå±‹å¤–ï¼‰","ã‚¢ãƒªãƒ¼ãƒŠ / ãƒ‰ãƒ¼ãƒ ","å¤§è¦æ¨¡ãƒ„ã‚¢ãƒ¼"], en:["Outdoor festivals","Arenas / domes","Large-scale touring"] },
      final:{ ja:"ã‚ãªãŸã¯ã€è·é›¢ã¨è¦æ¨¡ã‚’å‰æã«éŸ³ã‚’è€ƒãˆã‚‰ã‚Œã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚ã‚¹ã‚±ãƒ¼ãƒ«ã‚’æã‚Œãªã„åˆ¤æ–­ãŒã€å¤§ããªç¾å ´ã‚’æˆç«‹ã•ã›ã¾ã™ã€‚", en:"You design sound with distance and scale in mind. Your confidence with size makes large venues work." }
    },
    { key:"spatial_design",
      name:{ ja:"é…ç½®ãƒ»ç©ºé–“è¨­è¨ˆã‚¿ã‚¤ãƒ—", en:"Spatial Design Engineer" },
      desc:{ ja:"éŸ³è‰²ã‚ˆã‚Šå…ˆã«ç©ºé–“ã‚’è¦‹ã‚‹ã€‚é…ç½®ã¨å½¹å‰²åˆ†æ‹…ã§éŸ³ã‚’ä½œã‚‹â€œè¨­è¨ˆä¸»å°â€ã®äººã€‚", en:"Sees the room before the tone. Shapes results through placement and system roles." },
      approach:{ ja:["ã¾ãšç½®ãæ–¹ã‹ã‚‰è€ƒãˆã‚‹","å½¹å‰²åˆ†æ‹…ã§ç©ºé–“ã‚’ä½œã‚‹","åå°„ã‚„ãƒ ãƒ©ã‚’è¨­è¨ˆã§å›é¿"], en:["Placement first","Define system roles","Design around reflections and hotspots"] },
      genres:{ ja:["ä½“è‚²é¤¨ / ä»®è¨­ä¼šå ´","å¤‰å½¢ä¼šå ´","å¤šç›®çš„"], en:["Gyms / temporary setups","Odd-shaped venues","Multipurpose rooms"] },
      final:{ ja:"ã‚ãªãŸã¯ã€éŸ³è‰²ã‚ˆã‚Šå…ˆã«ç©ºé–“ã‚’è¦‹ã¦ã„ã¾ã™ã€‚é…ç½®ã§éŸ³ã‚’ä½œã‚Œã‚‹åˆ¤æ–­åŠ›ã¯ã€çµŒé¨“ã«è£æ‰“ã¡ã•ã‚ŒãŸå¼·ã¿ã§ã™ã€‚", en:"You see the space before you hear the tone. Shaping sound through placement shows true experience." }
    },
    { key:"reliability_driven",
      name:{ ja:"å†ç¾æ€§ãƒ»æˆç«‹é‡è¦–ã‚¿ã‚¤ãƒ—", en:"Reliability-Driven Engineer" },
      desc:{ ja:"æœ€é‡è¦ã¯æˆç«‹ã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šä¿¡é ¼ã‚’é¸ã³ã€èª­ã‚ã‚‹çµæœã§ãƒãƒ¼ãƒ ã‚’æ”¯ãˆã‚‹ã€‚", en:"Prioritizes reliability and predictability. Chooses trust over flash and supports the whole team." },
      approach:{ ja:["äº‹æ•…ã‚‰ãªã„æˆç«‹ã‚’æœ€å„ªå…ˆ","èª­ã‚ã‚‹çµæœã«å¯„ã›ã‚‹","å†ç¾æ€§ã‚ã‚‹æ‰‹é †ã§ä»•ä¸Šã’ã‚‹"], en:["Stability first","Aim for predictable results","Finish with repeatable workflow"] },
      genres:{ ja:["ä¼æ¥­ / ãƒ„ã‚¢ãƒ¼è¤‡æ•°æ—¥ç¨‹","ãƒ‰ãƒ¼ãƒ  / ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ","å¤šæ‹ ç‚¹é‹ç”¨"], en:["Corporate / multi-day touring","Domes / stadiums","Multi-venue operations"] },
      final:{ ja:"ã‚ãªãŸã¯ã€ç¾å ´ã‚’ç¢ºå®Ÿã«æˆç«‹ã•ã›ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šä¿¡é ¼ã‚’é¸ã¹ã‚‹åˆ¤æ–­ãŒã€ãƒãƒ¼ãƒ ã‚’æ”¯ãˆã¦ã„ã¾ã™ã€‚", en:"You are the engineer who makes shows happen. Choosing reliability over flash is what teams depend on." }
    }
  ];

  // --- Speaker vectors (heuristic) ---
  const VEC = {
    "Adamson":     { impact:4.7, detail:2.8, speed:4.1, throw:4.6, system:3.6, bias:"impact_attack" },
    "Clair":       { impact:4.6, detail:2.8, speed:4.2, throw:4.0, system:3.5, bias:"impact_attack" },
    "CODA":        { impact:4.1, detail:3.7, speed:4.7, throw:4.2, system:4.0, bias:"groove_transient" },
    "d&b":         { impact:3.8, detail:4.0, speed:3.7, throw:4.4, system:4.7, bias:"coverage_control" },
    "EAW":         { impact:3.7, detail:3.6, speed:3.6, throw:4.1, system:4.0, bias:"spatial_design" },
    "JBL":         { impact:4.4, detail:2.9, speed:4.0, throw:4.7, system:3.4, bias:"long_throw" },
    "L-Acoustics": { impact:4.0, detail:4.6, speed:4.2, throw:4.2, system:4.6, bias:"phase_clarity" },
    "Martin Audio":{ impact:3.7, detail:4.1, speed:3.8, throw:3.9, system:3.8, bias:"vocal_centric" },
    "Meyer Sound": { impact:3.9, detail:4.4, speed:4.0, throw:4.0, system:4.4, bias:"detail_focus" },
    "NEXO":        { impact:3.4, detail:3.5, speed:3.4, throw:3.9, system:4.1, bias:"reliability_driven" },
  };

  function pick(selId){ return ($(selId).value || "").trim(); }

  function sumAxes(picks){
    const total = { impact:0, detail:0, speed:0, throw:0, system:0 };
    const denom = WEIGHT.op + WEIGHT.own + WEIGHT.second;

    function add(speaker, w){
      const v = VEC[speaker];
      if(!v) return;
      AXES5.forEach(k => total[k] += (v[k] ?? 0) * w);
    }
    add(picks.op, WEIGHT.op);
    add(picks.own, WEIGHT.own);
    add(picks.second, WEIGHT.second);
    AXES5.forEach(k => total[k] = total[k] / denom);
    return total;
  }

  // --- NEW: relative stars (guarantee 3..5 and visible differences) ---
  // Rule: top1 => 5â˜…, next2 => 4â˜…, bottom2 => 3â˜…
  function relativeStars(total){
    const pairs = AXES5.map(k => ({ k, v: total[k] }));
    pairs.sort((a,b)=> b.v - a.v);

    const starMap = {};
    pairs.forEach((p, idx) => {
      if(idx === 0) starMap[p.k] = 5;
      else if(idx <= 2) starMap[p.k] = 4;
      else starMap[p.k] = 3;
    });

    return starMap;
  }
  function toStars(n){
    return "â˜…".repeat(n) + "â˜†".repeat(5-n);
  }

  function pickType(picks, total){
    const votes = {};
    function vote(speaker, w){
      const v = VEC[speaker];
      if(!v?.bias) return;
      votes[v.bias] = (votes[v.bias] || 0) + w;
    }
    vote(picks.op, WEIGHT.op);
    vote(picks.own, WEIGHT.own);
    vote(picks.second, WEIGHT.second);

    const axisMap = {
      impact: ["impact_attack","lowend_impact"],
      detail: ["detail_focus","phase_clarity","vocal_centric"],
      speed:  ["groove_transient"],
      throw:  ["long_throw","coverage_control","spatial_design"],
      system: ["reliability_driven","coverage_control"]
    };

    let bestAxis = "impact";
    let bestVal = total.impact;
    AXES5.forEach(k => { if(total[k] > bestVal){ bestAxis = k; bestVal = total[k]; } });

    const score = {};
    TYPES.forEach(t => score[t.key] = (votes[t.key] || 0));

    (axisMap[bestAxis] || []).forEach((k, idx) => {
      score[k] = (score[k] || 0) + (0.35 - idx*0.08);
    });

    const sortedAxes = AXES5.slice().sort((a,b)=> total[b]-total[a]);
    const secondAxis = sortedAxes[1];
    (axisMap[secondAxis] || []).forEach((k, idx) => {
      score[k] = (score[k] || 0) + (0.18 - idx*0.05);
    });

    let bestKey = TYPES[0].key;
    let bestScore = -Infinity;
    for(const k in score){
      if(score[k] > bestScore){ bestScore = score[k]; bestKey = k; }
    }
    return TYPES.find(t => t.key === bestKey) || TYPES[0];
  }

  function recommendOne(picks, total){
    const chosen = new Set([picks.op, picks.own, picks.second]);
    const candidates = SPEAKERS.filter(s => !chosen.has(s));

    const sorted = AXES5.slice().sort((a,b)=> total[a]-total[b]);
    const need1 = sorted[0], need2 = sorted[1];

    function benefit(s){
      const v = VEC[s];
      return (v?.[need1] ?? 0) * 1.15 + (v?.[need2] ?? 0) * 0.9 + (v?.system ?? 0)*0.15;
    }

    let best = candidates[0] || SPEAKERS[0];
    let bestVal = -Infinity;
    for(const s of candidates){
      const val = benefit(s);
      if(val > bestVal){ bestVal = val; best = s; }
    }
    return best;
  }

  function diagnosisBaseUrl(){
    const u = new URL(window.location.href);
    return u.origin + u.pathname;
  }

  function buildShareUrl(picks, name, lang){
    const u = new URL(diagnosisBaseUrl());
    if(name) u.searchParams.set("name", name);
    u.searchParams.set("lang", lang);
    u.searchParams.set("op", picks.op);
    u.searchParams.set("own", picks.own);
    u.searchParams.set("second", picks.second);
    return u.toString();
  }

  function buildTweetText(lang, name, picks, type, diagUrl){
    const speakersLine = `${picks.op} / ${picks.own} / ${picks.second}`;
    const nameLineJa = name ? `ã€${name}ã®è¨ºæ–­ã€‘` : "";
    const nameLineEn = name ? `(${name}'s result)` : "";

    const jpFull = [
      "ğŸ§ å¥½ã¿ã®ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã‚ã‹ã‚‹",
      "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­",
      nameLineJa,
      "",
      "é¸ã‚“ã ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ï¼š",
      speakersLine,
      "",
      "è¨ºæ–­çµæœï¼š",
      type.name.ja,
      "",
      "ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®é¸ã³æ–¹ã«ã€åˆ¤æ–­è»¸ã¯å‡ºã‚‹ã€‚",
      "ã‚ãªãŸã¯ã©ã®ã‚¿ã‚¤ãƒ—ï¼Ÿ",
      "",
      "â–¶ è¨ºæ–­ã¯ã“ã¡ã‚‰",
      diagUrl,
      "#PA #éŸ³éŸ¿ #LiveSound"
    ].filter(Boolean).join("\n");

    const jpMid = [
      "ğŸ§ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­",
      nameLineJa,
      `Speakersï¼š${speakersLine}`,
      `Resultï¼š${type.name.ja}`,
      "ã‚ãªãŸã¯ã©ã®ã‚¿ã‚¤ãƒ—ï¼Ÿ",
      diagUrl,
      "#PA #éŸ³éŸ¿"
    ].filter(Boolean).join("\n");

    const jpShort = [
      "ğŸ§ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¿ã‚¤ãƒ—è¨ºæ–­",
      nameLineJa,
      `Speakersï¼š${speakersLine}`,
      `Resultï¼š${type.name.ja}`,
      diagUrl
    ].filter(Boolean).join("\n");

    const enFull = [
      "ğŸ§ Engineer Type Diagnosis",
      "Based on Speaker Preference",
      nameLineEn,
      "",
      "Selected Speakers:",
      speakersLine,
      "",
      "Result:",
      type.name.en,
      "",
      "The way you choose speakers reveals your mindset.",
      "What type are you?",
      "",
      "â–¶ Take the test",
      diagUrl,
      "#LiveSound #PA"
    ].filter(Boolean).join("\n");

    const enMid = [
      "ğŸ§ Engineer Type Diagnosis",
      nameLineEn,
      `Speakers: ${speakersLine}`,
      `Result: ${type.name.en}`,
      "What type are you?",
      diagUrl,
      "#LiveSound #PA"
    ].filter(Boolean).join("\n");

    const enShort = [
      "ğŸ§ Engineer Type Diagnosis",
      nameLineEn,
      `Speakers: ${speakersLine}`,
      `Result: ${type.name.en}`,
      diagUrl
    ].filter(Boolean).join("\n");

    const candidates = (lang === "ja") ? [jpFull, jpMid, jpShort] : [enFull, enMid, enShort];
    for(const c of candidates){ if(c.length <= 280) return c; }
    const last = candidates[candidates.length - 1];
    if(last.length <= 280) return last;

    const lines = last.split("\n");
    const urlLine = lines[lines.length - 1];
    let base = lines.slice(0, -1).join("\n");
    const max = 280 - (urlLine.length + 1);
    base = base.slice(0, Math.max(0, max));
    return base + "\n" + urlLine;
  }

  function renderResult(lang, name, picks, type, total, rec, shareUrl){
    const L = AXIS_LABEL[lang];
    const titlePrefix = name
      ? (lang === "ja" ? `${name}ã•ã‚“ã®çµæœ` : `${name}'s Result`)
      : (lang === "ja" ? "è¨ºæ–­çµæœ" : "Result");

    const approachList = type.approach[lang].map(s => `â€¢ ${escapeHtml(s)}`).join("<br/>");
    const genresList = type.genres[lang].map(s => `â€¢ ${escapeHtml(s)}`).join("<br/>");

    // NEW: relative star distribution 3..5 guaranteed
    const starMap = relativeStars(total);

    const balanceRows = AXES5.map(k => {
      const label = L[k];
      const stars = toStars(starMap[k]); // 3..5 only
      return `<div class="kitem"><span>${escapeHtml(label)}</span><span class="stars">${stars}</span></div>`;
    }).join("");

    const section = (title, body) => `
      <div class="hr"></div>
      <span class="badge">${escapeHtml(title)}</span>
      <div class="desc">${body}</div>
    `;

    $("out").innerHTML = `
      <span class="badge">${escapeHtml(titlePrefix)}</span>

      ${section(lang === "ja" ? "1. ã‚¿ã‚¤ãƒ—" : "1. Type", `
        <div class="title">${escapeHtml(type.name[lang])}</div>
        <div class="desc">${escapeHtml(type.desc[lang])}</div>
      `)}

      ${section(lang === "ja" ? "2. ãƒŸãƒƒã‚¯ã‚¹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ" : "2. Mixing Approach", approachList)}

      ${section(lang === "ja" ? "3. ç·åˆãƒãƒ©ãƒ³ã‚¹" : "3. Overall Balance", `
        <div class="klist">${balanceRows}</div>
      `)}

      ${section(lang === "ja" ? "4. é©ã—ã¦ã„ã‚‹ã‚¸ãƒ£ãƒ³ãƒ«" : "4. Suitable Genres", genresList)}

      ${section(lang === "ja" ? "5. ä»–ã«ãŠå‹§ã‚ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼" : "5. Recommended Speaker", `
        <strong>â–¶ ${escapeHtml(rec)}</strong>
      `)}

      ${section(lang === "ja" ? "6. ç·è©•" : "6. Final Comment", escapeHtml(type.final[lang]))}

      ${section(lang === "ja" ? "é¸ã‚“ã ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼" : "Selected Speakers", escapeHtml(`${picks.op} / ${picks.own} / ${picks.second}`))}

      ${section(lang === "ja" ? "å…±æœ‰ãƒªãƒ³ã‚¯" : "Share Link", `<div class="mono" style="word-break:break-all;">${escapeHtml(shareUrl)}</div>`)}
    `;
  }

  function updateTweetUI(text){
    $("tweetPreview").value = text;
    $("countInfo").textContent = `Length: ${text.length} / 280`;
  }

  function run(){
    const lang = $("lang").value;
    const name = ($("name").value || "").trim();

    const picksObj = { op: pick("op"), own: pick("own"), second: pick("second") };
    if(!picksObj.op || !picksObj.own || !picksObj.second){
      alert(lang === "ja" ? "3ã¤ã¨ã‚‚é¸ã‚“ã§ãã ã•ã„" : "Please select all 3 speakers.");
      return;
    }

    const total = sumAxes(picksObj);
    const type = pickType(picksObj, total);
    const rec = recommendOne(picksObj, total);

    const diagUrl = diagnosisBaseUrl();
    const shareUrl = buildShareUrl(picksObj, name, lang);

    renderResult(lang, name, picksObj, type, total, rec, shareUrl);

    const tweetText = buildTweetText(lang, name, picksObj, type, diagUrl);
    updateTweetUI(tweetText);

    $("tweet").style.display = "block";
    $("copy").style.display = "block";

    $("tweet").onclick = () => {
      const intent = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(tweetText);
      window.open(intent, "_blank");
    };

    $("copy").onclick = async () => {
      try{
        await navigator.clipboard.writeText(tweetText);
        $("copy").textContent = "Copied âœ…";
        setTimeout(()=> $("copy").textContent = "Copy X Text / æŠ•ç¨¿æ–‡ã‚’ã‚³ãƒ”ãƒ¼", 900);
      }catch(e){
        alert((lang === "ja") ? "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ã®å¯èƒ½æ€§ï¼‰" : "Copy failed (browser restriction).");
      }
    };

    const u = new URL(diagnosisBaseUrl());
    u.searchParams.set("lang", lang);
    if(name) u.searchParams.set("name", name);
    u.searchParams.set("op", picksObj.op);
    u.searchParams.set("own", picksObj.own);
    u.searchParams.set("second", picksObj.second);
    history.replaceState(null, "", u.toString());
  }

  $("calc").addEventListener("click", run);

  (function init(){
    const sp = new URLSearchParams(window.location.search);

    const lang = sp.get("lang");
    if(lang === "ja" || lang === "en") $("lang").value = lang;

    const name = sp.get("name");
    if(name) $("name").value = name;

    const op = sp.get("op"), own = sp.get("own"), second = sp.get("second");

    function setSelect(selId, value){
      const sel = $(selId);
      const values = Array.from(sel.options).map(o => o.value);
      if(values.includes(value)) sel.value = value;
    }

    if(op) setSelect("op", op);
    if(own) setSelect("own", own);
    if(second) setSelect("second", second);

    if(op && own && second){ run(); }
  })();
</script>

  <a href="https://www.youtube.com/@%E7%A5%9E%E3%80%85%E3%81%AE%E9%87%8C"
   target="_blank"
   rel="noopener"
   style="display:block; margin:32px auto; max-width:600px;">
  <img src="kamisato_banner.png"
       alt="ç¥ã€…ã®é‡Œ"
       style="width:100%; border-radius:12px;">
</a>

  <footer style="text-align:center; padding:24px; font-size:14px;">
  <a href="https://onetwo.co.jp"
     target="_blank"
     rel="noopener"
     style="
       color:#cfe7ff;
       text-decoration:none;
       letter-spacing:0.5px;
     ">
    Supervised by <strong>ONETWO</strong>
  </a>
</footer>

</body>
</html>
